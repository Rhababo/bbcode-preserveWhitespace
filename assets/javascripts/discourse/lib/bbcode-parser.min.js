/* Source code in bbcode-src */
const t=t=>"object"==typeof t&&!!t.tag;function e(e,n,r,s){n.walk((n=>t(n)&&e[n.tag]?e[n.tag](n,r,s):n))}const n={b:t=>({tag:"span",attr:{style:"font-weight: bold","data-rpn-bbcode":""},content:t.content}),font:(t,e)=>(console.log(e),{tag:"span",content:t.content}),nobr:t=>({disableLineBreakConversion:!0,content:t.content})},r=Object.keys(n),s=function t(n,r=e){const s=(t={})=>{s.options=Object.assign(s.options||{},t);const e=(t,e)=>r(n,t,e,s.options);return e.options=s.options,e};return s.extend=e=>t(e(n,s.options),r),s}(n),o="\n",a="\t",i="=",c='"',u=" ",l="[",g="]",h="/",p="\\",f=t=>"object"==typeof t&&!!t.tag,d=(t,e,n)=>Object.keys(t).reduce(e,n),T=t=>f(t)?t.content.reduce(((t,e)=>t+T(e)),0):"string"==typeof t?t.length:0,b=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript|data|vbscript):/gi,"$1%3A"),y=(t,e)=>{const n=typeof e,r={boolean:()=>e?`${t}`:"",number:()=>`${t}="${e}"`,string:()=>`${t}="${b(e)}"`,object:()=>`${t}="${b(JSON.stringify(e))}"`};return r[n]?r[n]():""},A=t=>null==t?"":d(t,((e,n)=>[...e,y(n,t[n])]),[""]).join(" "),k=(t,e)=>{const n=d(r=e,((t,e)=>r[e]===e?r[e]:null),null);var r;if(n){const r=y(t,n),s={...e};delete s[n];return`${r}${A(s)}`}return`${t}${A(e)}`};class m{attr(t,e){return void 0!==e&&(this.attrs[t]=e),this.attrs[t]}append(t){return((t,e)=>{t.content.push(e)})(this,t)}get length(){return T(this)}toTagStart({openTag:t=l,closeTag:e=g}={}){return`${t}${k(this.tag,this.attrs)}${e}`}toTagEnd({openTag:t=l,closeTag:e=g}={}){return`${t}${h}${this.tag}${e}`}toTagNode(){return new m(this.tag.toLowerCase(),this.attrs,this.content)}toString({openTag:t=l,closeTag:e=g}={}){const n=0===this.content.length,r=this.content.reduce(((n,r)=>n+r.toString({openTag:t,closeTag:e})),""),s=this.toTagStart({openTag:t,closeTag:e});return n?s:`${s}${r}${this.toTagEnd({openTag:t,closeTag:e})}`}constructor(t,e,n){this.tag=t,this.attrs=e,this.content=Array.isArray(n)?n:[n]}}m.create=(t,e={},n=[])=>new m(t,e,n),m.isOf=(t,e)=>t.tag===e;const N="type",$="value",v="line",w=t=>t&&void 0!==t[$]?t[$]:"",x=t=>w(t).charCodeAt(0)===h.charCodeAt(0);class L{isEmpty(){return isNaN(this[N])}isText(){return!(!(t=this)||void 0===t[N]||5!==t[N]&&6!==t[N]&&1!==t[N]);var t}isTag(){return!(!(t=this)||void 0===t[N])&&2===t[N];var t}isAttrName(){return!(!(t=this)||void 0===t[N])&&3===t[N];var t}isAttrValue(){return!(!(t=this)||void 0===t[N])&&4===t[N];var t}isStart(){return!x(this)}isEnd(){return x(this)}getName(){return(t=>{const e=w(t);return x(t)?e.slice(1):e})(this)}getValue(){return w(this)}getLine(){return(t=this)&&t[v]||0;var t}getColumn(){return(t=this)&&t.row||0;var t}toString(){return(t=>{let e=l;return e+=w(t),e+=g,e})(this)}constructor(t,e,n,r){this[N]=Number(t),this[$]=String(e),this[v]=Number(n),this.row=Number(r)}}function C(t,e){const n={pos:0,len:t.length},r=()=>n.len>n.pos,s=(t=1,r)=>{n.pos+=t,e&&e.onSkip&&!r&&e.onSkip()},o=()=>t[n.pos];this.skip=s,this.hasNext=r,this.getCurr=o,this.getRest=()=>t.substring(n.pos),this.getNext=()=>{const e=n.pos+1;return e<=t.length-1?t[e]:null},this.getPrev=()=>{const e=n.pos-1;return void 0!==t[e]?t[e]:null},this.isLast=()=>n.pos===n.len,this.includes=e=>t.indexOf(e,n.pos)>=0,this.grabWhile=(e,a)=>{let i=0;if(r())for(i=n.pos;r()&&e(o());)s(1,a);return t.substring(i,n.pos)},this.grabN=(e=0)=>t.substring(n.pos,n.pos+e),this.substrUntilChar=e=>{const{pos:r}=n,s=t.indexOf(e,r);return s>=0?t.substring(r,s):""}}const E=(t,e)=>new C(t,e);function S(t=[]){const e=t;this.push=t=>e.push(t),this.toArray=()=>e,this.getLast=()=>Array.isArray(e)&&e.length>0&&void 0!==e[e.length-1]?e[e.length-1]:null,this.flushLast=()=>!!e.length&&e.pop()}const O=(t=[])=>new S(t);function j(t,e={}){const n=0,r=1,s=2,f=0,d=1,T=2;let b=0,y=0,A=-1,k=n,m=f,N="";const $=new Array(Math.floor(t.length)),v=e.openTag||l,w=e.closeTag||g,x=!!e.enableEscapeTags,C=e.contextFreeTags||[],S=e.onToken||(()=>{}),O=[w,v,c,p,u,a,i,o,"!"],j=[v,u,a,o],W=[u,a],V=[i,u,a],z=t=>O.indexOf(t)>=0,P=t=>t===o,B=t=>W.indexOf(t)>=0,F=t=>-1===j.indexOf(t),U=t=>V.indexOf(t)>=0,q=t=>t===v||t===w||t===p,I=t=>t===p,J=()=>{y++},M=t=>((t,e)=>{for(;t.charAt(0)===e;)t=t.substring(1);for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t})(t,c).replace(p+c,c),R=(t,e)=>{""!==N&&e&&(N=""),""===N&&C.includes(t)&&(N=t)},D=E(t,{onSkip:J});function G(t,e){const n=((t,e,n=0,r=0)=>new L(t,e,n,r))(t,e,b,y);S(n),A+=1,$[A]=n}function H(t,e){if(m===d){const e=t=>!(t===i||B(t)),n=t.grabWhile(e),r=t.isLast(),s=t.getCurr()!==i;return t.skip(),r||s?G(4,M(n)):G(3,n),r?f:s?d:T}if(m===T){let n=!1;const r=r=>{const s=r===c,o=t.getPrev(),a=t.getNext(),u=o===p,l=a===i,g=B(r),h=B(a);return!(!n||!U(r))||!!(!s||u||(n=!n,n||l||h))&&(!!e||!1===g)},s=t.grabWhile(r);return t.skip(),G(4,M(s)),t.isLast()?f:d}const n=t.grabWhile((e=>!(e===i||B(e)||t.isLast())));if(G(2,n),R(n),t.skip(),e)return T;return t.includes(i)?d:T}function K(){const t=D.getCurr(),e=D.getNext();D.skip();const r=D.substrUntilChar(w),o=0===r.length||r.indexOf(v)>=0;if(z(e)||o||D.isLast())return G(1,t),n;const a=-1===r.indexOf(i),c=r[0]===h;if(a||c){const t=D.grabWhile((t=>t!==w));return D.skip(),G(2,t),R(t,c),n}return s}function Q(){const t=D.grabWhile((t=>t!==w),!0),e=E(t,{onSkip:J}),r=e.includes(u);for(m=f;e.hasNext();)m=H(e,!r);return D.skip(),n}function X(){if(P(D.getCurr()))return G(6,D.getCurr()),D.skip(),y=0,b++,n;if(B(D.getCurr())){return G(5,D.grabWhile(B)),n}if(D.getCurr()===v){if(N){const t=v.length+1+N.length,e=`${v}${h}${N}`;if(D.grabN(t)===e)return r}else if(D.includes(w))return r;return G(1,D.getCurr()),D.skip(),n}if(x){if(I(D.getCurr())){const t=D.getCurr(),e=D.getNext();return D.skip(),q(e)?(D.skip(),G(1,e),n):(G(1,t),n)}const t=t=>F(t)&&!I(t);return G(1,D.grabWhile(t)),n}return G(1,D.grabWhile(F)),n}return{tokenize:function(){for(k=n;D.hasNext();)switch(k){case r:k=K();break;case s:k=Q();break;default:k=X()}return $.length=A+1,$},isTokenNested:function(e){const n=v+h+e.getValue();return t.indexOf(n)>-1}}}const W=(t,e={})=>{const n=e,r=n.openTag||l,s=n.closeTag||g;let o=null;const a=O(),i=O(),c=O(),u=O(),h=new Set,p=()=>{c.flushLast()&&u.flushLast()},d=t=>{const e=(()=>{const t=i.getLast();return t&&Array.isArray(t.content)?t.content:a.toArray()})();var o;Array.isArray(e)&&(f(t)?(o=t.tag,!n.onlyAllowTags||!n.onlyAllowTags.length||n.onlyAllowTags.indexOf(o)>=0?e.push(t.toTagNode()):(e.push(t.toTagStart({openTag:r,closeTag:s})),t.content.length&&(t.content.forEach((t=>{e.push(t)})),e.push(t.toTagEnd({openTag:r,closeTag:s}))))):e.push(t))},T=t=>{p();const e=m.create(t.getValue()),n=(t=>{const e=t.getValue();return!h.has(e)&&o.isTokenNested&&o.isTokenNested(t)?(h.add(e),!0):h.has(e)})(t);c.push(e),n?i.push(e):d(e)},b=t=>{t.isStart()&&T(t),t.isEnd()&&(t=>{p();const e=i.flushLast();if(e)d(e);else if("function"==typeof n.onError){const e=t.getValue(),r=t.getLine(),s=t.getColumn();n.onError({message:`Inconsistent tag '${e}' on line ${r} and column ${s}`,tagName:e,lineNumber:r,columnNumber:s})}})(t)},y=t=>{const e=c.getLast(),n=t.getValue(),r=(s=t,Boolean(h.has(s)));var s;if(e)if(t.isAttrName())u.push(n),e.attr(u.getLast(),"");else if(t.isAttrValue()){const t=u.getLast();t?(e.attr(t,n),u.flushLast()):e.attr(n,n)}else t.isText()?r?e.append(n):d(n):t.isTag()&&d(t.toString());else t.isText()?d(n):t.isTag()&&d(t.toString())};return o=(e.createTokenizer?e.createTokenizer:j)(t,{onToken:t=>{t.isTag()?b(t):y(t)},openTag:r,closeTag:s,onlyAllowTags:n.onlyAllowTags,contextFreeTags:n.contextFreeTags,enableEscapeTags:n.enableEscapeTags}),o.tokenize(),a.toArray()},V=t=>"object"==typeof t,z=t=>"boolean"==typeof t;function P(t,e){const n=t;if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=P(e(n[t]),e);else n&&V(n)&&n.content&&P(n.content,e);return n}function B(t,e){return typeof t==typeof e&&(V(t)&&null!==t?Array.isArray(t)?t.every((t=>[].some.call(e,(e=>B(t,e))))):Object.keys(t).every((n=>{const r=e[n],s=t[n];return V(s)&&null!==s&&null!==r?B(s,r):z(s)?s!==(null===r):r===s})):t===e)}function F(t,e){return Array.isArray(t)?P(this,(n=>{for(let r=0;r<t.length;r++)if(B(t[r],n))return e(n);return n})):P(this,(n=>B(t,n)?e(n):n))}function U(t){return P(this,t)}const q="/>",I="</",J="<",M=">",R=(t,{stripTags:e=!1}={})=>[].concat(t).reduce(((t,n)=>t+((t,{stripTags:e=!1})=>{if(!t)return"";const n=typeof t;return"string"===n||"number"===n?t:"object"===n?!0===e?R(t.content,{stripTags:e}):null===t.content?[J,t.tag,A(t.attrs),q].join(""):[J,t.tag,A(t.attrs),M,R(t.content),I,t.tag,M].join(""):Array.isArray(t)?R(t,{stripTags:e}):""})(n,{stripTags:e})),""),D=R,G=t=>{const e=t;if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=G(e[t]);Array.isArray(n)?(e.splice(t,1,...n),t+=n.length):e[t]=n}else if(e&&"object"==typeof e&&e.content){if(e.disableLineBreakConversion)return e.tag?e:e.content;G(e.content)}return e===o?{tag:"br",content:null}:e},H={onlyAllowTags:[...r,"nobr"],enableEscapeTags:!0,onError:t=>console.warn(t.message,t.lineNumber,t.columnNumber),data:[]},K=t=>function(t){const e="function"==typeof t?[t]:t||[];let n={skipParse:!1};return{process(t,r){n=r||{};const s=n.parser||W,o=n.render,a=n.data||null;if("function"!=typeof s)throw new Error('"parser" is not a function, please pass to "process(input, { parser })" right function');let i=n.skipParse?t||[]:s(t,n);const c=i;return i.messages=[],i.options=n,i.walk=U,i.match=F,e.forEach((t=>{i=t(i,{parse:s,render:o,iterate:P,match:F,data:a})||i})),{get html(){if("function"!=typeof o)throw new Error('"render" function not defined, please pass to "process(input, { render })"');return o(i,i.options)},tree:i,raw:c,messages:i.messages}}}}([s(),t=>G(t)]).process(t,{render:D,...H});export{K as RpNBBCode};
//# sourceMappingURL=bbcode-parser.min.js.map
